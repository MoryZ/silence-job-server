# å®ä½“å­—æ®µç±»å‹åˆ†ææŠ¥å‘Š

ç”Ÿæˆæ—¶é—´: 2026-02-05

## ğŸ“Š é—®é¢˜æ¦‚è§ˆ

æ‰€æœ‰å®ä½“ç±»éƒ½ç»§æ‰¿ç›¸åŒçš„åŸºç±»ï¼ˆ**AbstractAutoGeneratedIdAuditableTenantable** æˆ– **AbstractAutoGeneratedIdLogicalDeletionAuditable**ï¼‰ï¼Œä½†å­˜åœ¨å¤§é‡çš„**å­—æ®µç±»å‹ä¸è§„èŒƒ**é—®é¢˜ï¼š

1. âš ï¸ **æšä¸¾å­—æ®µè¢«å£°æ˜ä¸º String**
2. âš ï¸ **JSON å†…å®¹è¢«å­˜å‚¨åœ¨ String å­—æ®µä¸­ï¼Œæ²¡æœ‰ç±»å‹æç¤º**
3. âš ï¸ **ç¼ºå°‘ @TableField æ³¨è§£æ¥æŒ‡å®š JDBC ç±»å‹è½¬æ¢**

---

## ğŸ”´ å…³é”®é—®é¢˜åˆ—è¡¨

### é—®é¢˜ 1: æšä¸¾å­—æ®µçš„æ··ä¹±

æ‰€æœ‰æšä¸¾å­—æ®µéƒ½å·²æ­£ç¡®å£°æ˜ä¸ºæšä¸¾ç±»å‹ âœ…ï¼Œä½¿ç”¨äº† MyBatis-Plus è‡ªåŠ¨æ˜ å°„ï¼š

| å­—æ®µ | ç±»å‹ | æ‰€å±è¡¨ | è¯´æ˜ |
|------|------|--------|------|
| `jobStatus` | Boolean | sj_job | 0=å…³é—­, 1=å¼€å¯ |
| `executorType` | ExecutorType | sj_job | Java æ‰§è¡Œå™¨ç±»å‹ |
| `triggerType` | TriggerType | sj_job | CRON/å›ºå®šæ—¶é—´ |
| `blockStrategy` | JobBlockStrategy | sj_job | é˜»å¡ç­–ç•¥ï¼šä¸¢å¼ƒ/è¦†ç›–/å¹¶è¡Œ |
| `taskType` | JobTaskType | sj_job | ä»»åŠ¡ç±»å‹ |
| `argsType` | JobArgsType | sj_job | TEXT/JSON |
| `retryStatus` | RetryStatus | sj_retry | é‡è¯•çŠ¶æ€ |
| `taskType` | SystemTaskType | sj_retry | ç³»ç»Ÿä»»åŠ¡ç±»å‹ |
| `taskStatus` | RetryTaskStatus | sj_retry_task | ä»»åŠ¡çŠ¶æ€ |
| `operationReason` | RetryOperationReason | sj_retry_task | æ“ä½œåŸå›  |

**çŠ¶æ€**: âœ… è¿™äº›æšä¸¾å­—æ®µå®šä¹‰æ­£ç¡®

---

### é—®é¢˜ 2: å­—ç¬¦ä¸²å­—æ®µå­˜å‚¨ JSON å†…å®¹ï¼ˆé«˜é£é™©ï¼‰

è¿™äº›å­—æ®µå®é™…å­˜å‚¨ JSONï¼Œä½†è¢«å£°æ˜ä¸ºæ™®é€š Stringï¼Œ**ç¼ºå°‘ç±»å‹è½¬æ¢æç¤º**ï¼š

| å­—æ®µå | æ‰€åœ¨è¡¨ | å®é™…å†…å®¹ | é£é™©ç­‰çº§ |
|--------|--------|---------|---------|
| `argsStr` | sj_job | æ‰§è¡Œæ–¹æ³•å‚æ•° (JSON) | ğŸ”´ é«˜ |
| `extAttrs` | sj_job | æ‰©å±•å±æ€§ (JSON) | ğŸ”´ é«˜ |
| `executorInfo` | sj_job | æ‰§è¡Œå™¨ä¿¡æ¯ (JSON) | ğŸ”´ é«˜ |
| `clientInfo` | sj_job_task | å®¢æˆ·ç«¯ä¿¡æ¯ (JSON) | ğŸ”´ é«˜ |
| `wfContext` | sj_job_task | å·¥ä½œæµä¸Šä¸‹æ–‡ (JSON) | ğŸ”´ é«˜ |
| `resultMessage` | sj_job_task | ç»“æœæ¶ˆæ¯ (å¯èƒ½æ˜¯ JSON) | ğŸŸ¡ ä¸­ |
| `argsStr` | sj_retry | é‡è¯•å‚æ•° (JSON) | ğŸ”´ é«˜ |
| `extAttrs` | sj_retry | æ‰©å±•å±æ€§ (JSON) | ğŸ”´ é«˜ |
| `argsStr` | sj_retry_dead_letter | æ­»ä¿¡å‚æ•° (JSON) | ğŸ”´ é«˜ |
| `extAttrs` | sj_retry_dead_letter | æ‰©å±•å±æ€§ (JSON) | ğŸ”´ é«˜ |
| `extAttrs` | sj_retry_task | æ‰©å±•å±æ€§ (JSON) | ğŸ”´ é«˜ |
| `clientInfo` | sj_retry_task | å®¢æˆ·ç«¯ä¿¡æ¯ (JSON) | ğŸ”´ é«˜ |
| `notifyAttribute` | sj_notify_recipient | é€šçŸ¥å±æ€§ (JSON) | ğŸ”´ é«˜ |
| `message` | sj_job_log_message | æ—¥å¿—æ¶ˆæ¯ (JSON) | ğŸŸ¡ ä¸­ |
| `message` | sj_retry_task_log_message | æ—¥å¿—æ¶ˆæ¯ (JSON) | ğŸŸ¡ ä¸­ |

**æ€»è®¡**: 15 ä¸ªå­—æ®µå­˜å‚¨ JSON å†…å®¹ä½†å£°æ˜ä¸º String

---

### é—®é¢˜ 3: å­—ç¬¦ä¸²å­—æ®µå­˜å‚¨ ID åˆ—è¡¨æˆ–åˆ†éš”ç¬¦æ•°æ®

è¿™äº›å­—æ®µç”¨äºå­˜å‚¨å¤šä¸ª ID æˆ–ä½¿ç”¨åˆ†éš”ç¬¦çš„æ•°æ®ï¼š

| å­—æ®µå | æ‰€åœ¨è¡¨ | å®é™…å†…å®¹ | å­˜å‚¨æ ¼å¼ | é£é™©ç­‰çº§ |
|--------|--------|---------|---------|---------|
| `notifyIds` | sj_job | é€šçŸ¥ ID åˆ—è¡¨ | é€—å·åˆ†éš” | ğŸŸ¡ ä¸­ |
| `notifyIds` | sj_retry_scene_config | é€šçŸ¥ ID åˆ—è¡¨ | é€—å·åˆ†éš” | ğŸŸ¡ ä¸­ |
| `recipientIds` | sj_notify_config | æ”¶ä»¶äºº ID åˆ—è¡¨ | é€—å·åˆ†éš” | ğŸŸ¡ ä¸­ |

**é—®é¢˜**: åº”è¯¥ä½¿ç”¨ JSON æ•°ç»„ `["id1", "id2"]` è€Œä¸æ˜¯é€—å·åˆ†éš”

---

## ğŸ“‹ å®Œæ•´å®ä½“å­—æ®µæ˜ å°„è¡¨

### 1ï¸âƒ£ Job å®ä½“ - sj_job

```java
public class Job extends AbstractAutoGeneratedIdAuditableTenantable<BigInteger, String> {
    // åŸºç¡€ä¿¡æ¯
    private String groupName;              // ç»„å
    private String jobName;                // ä»»åŠ¡å
    private String description;            // æè¿°
    
    // æ‰§è¡Œç›¸å…³ï¼ˆJSON å†…å®¹ï¼‰
    private String argsStr;                // ğŸ”´ å‚æ•° (JSON)
    private String extAttrs;               // ğŸ”´ æ‰©å±•å±æ€§ (JSON)
    private String executorInfo;           // ğŸ”´ æ‰§è¡Œå™¨ä¿¡æ¯ (JSON)
    
    // è§¦å‘ç›¸å…³
    private String triggerInterval;        // è§¦å‘é—´éš” (CRON è¡¨è¾¾å¼æˆ–æ•°å­—)
    private TriggerType triggerType;       // è§¦å‘ç±»å‹æšä¸¾ âœ…
    private Long nextTriggerAt;            // ä¸‹æ¬¡è§¦å‘æ—¶é—´
    
    // çŠ¶æ€å’Œç­–ç•¥
    private Boolean jobStatus;             // ä»»åŠ¡çŠ¶æ€ âœ…
    private JobBlockStrategy blockStrategy;// é˜»å¡ç­–ç•¥æšä¸¾ âœ…
    private JobArgsType argsType;          // å‚æ•°ç±»å‹æšä¸¾ âœ…
    
    // æ‰§è¡Œé…ç½®
    private ExecutorType executorType;     // æ‰§è¡Œå™¨ç±»å‹æšä¸¾ âœ…
    private Integer routeKey;              // è·¯ç”±é”®
    private Integer executorTimeout;       // è¶…æ—¶æ—¶é—´ (ç§’)
    private Integer maxRetryTimes;         // æœ€å¤§é‡è¯•æ¬¡æ•°
    private Integer retryInterval;         // é‡è¯•é—´éš” (ç§’)
    
    // ä»»åŠ¡ç»„ç»‡
    private JobTaskType taskType;          // ä»»åŠ¡ç±»å‹æšä¸¾ âœ…
    private Integer parallelNum;           // å¹¶è¡Œæ•°
    private String notifyIds;              // ğŸŸ¡ é€šçŸ¥ ID åˆ—è¡¨ (é€—å·åˆ†éš”)
    private String ownerName;              // æ‰€æœ‰è€…åç§°
}
```

### 2ï¸âƒ£ Retry å®ä½“ - sj_retry

```java
public class Retry extends AbstractAutoGeneratedIdAuditableTenantable<BigInteger, String> {
    // åŸºç¡€ä¿¡æ¯
    private String groupName;              // ç»„å
    private String sceneName;              // åœºæ™¯å
    private String bizNo;                  // ä¸šåŠ¡å·
    private String idempotentId;           // å¹‚ç­‰ ID
    
    // æ‰§è¡Œç›¸å…³ï¼ˆJSON å†…å®¹ï¼‰
    private String argsStr;                // ğŸ”´ é‡è¯•å‚æ•° (JSON)
    private String extAttrs;               // ğŸ”´ æ‰©å±•å±æ€§ (JSON)
    private String executorName;           // æ‰§è¡Œå™¨åç§°
    
    // çŠ¶æ€ä¿¡æ¯
    private RetryStatus retryStatus;       // é‡è¯•çŠ¶æ€æšä¸¾ âœ…
    private SystemTaskType taskType;       // ç³»ç»Ÿä»»åŠ¡ç±»å‹æšä¸¾ âœ…
    private Integer retryCount;            // é‡è¯•æ¬¡æ•°
    
    // è°ƒåº¦ç›¸å…³
    private Long nextTriggerAt;            // ä¸‹æ¬¡è§¦å‘æ—¶é—´
    private BigInteger parentId;           // çˆ¶ä»»åŠ¡ ID
    private Integer bucketIndex;           // æ¡¶ç´¢å¼•
    
    // åˆ é™¤æ ‡è®°
    @TableLogic
    private Boolean deleted;               // é€»è¾‘åˆ é™¤æ ‡è®°
}
```

### 3ï¸âƒ£ RetryTask å®ä½“ - sj_retry_task

```java
public class RetryTask extends AbstractAutoGeneratedIdAuditableTenantable<BigInteger, String> {
    // åŸºç¡€ä¿¡æ¯
    private String groupName;              // ç»„å
    private String sceneName;              // åœºæ™¯å
    private BigInteger retryId;            // é‡è¯• ID
    
    // æ‰§è¡Œç›¸å…³ï¼ˆJSON å†…å®¹ï¼‰
    private String extAttrs;               // ğŸ”´ æ‰©å±•å±æ€§ (JSON)
    private String clientInfo;             // ğŸ”´ å®¢æˆ·ç«¯ä¿¡æ¯ (JSON)
    
    // çŠ¶æ€ä¿¡æ¯
    private RetryTaskStatus taskStatus;    // ä»»åŠ¡çŠ¶æ€æšä¸¾ âœ…
    private SystemTaskType taskType;       // ç³»ç»Ÿä»»åŠ¡ç±»å‹æšä¸¾ âœ…
    private RetryOperationReason operationReason;  // æ“ä½œåŸå› æšä¸¾ âœ…
}
```

### 4ï¸âƒ£ JobTask å®ä½“ - sj_job_task

```java
public class JobTask extends AbstractAutoGeneratedIdAuditableTenantable<BigInteger, String> {
    // åŸºç¡€ä¿¡æ¯
    private String groupName;              // ç»„å
    private String taskName;               // ä»»åŠ¡å
    private BigInteger jobId;              // ä»»åŠ¡ ID
    private Integer retryCount;            // é‡è¯•è®¡æ•° ğŸ”´ (å­—æ®µæ³¨è§£æœ‰é—®é¢˜)
    
    // æ‰§è¡Œç›¸å…³ï¼ˆJSON å†…å®¹ï¼‰
    private String argsStr;                // ğŸ”´ å‚æ•° (JSON)
    private String extAttrs;               // ğŸ”´ æ‰©å±•å±æ€§ (JSON)
    private String clientInfo;             // ğŸ”´ å®¢æˆ·ç«¯ä¿¡æ¯ (JSON)
    private String wfContext;              // ğŸ”´ å·¥ä½œæµä¸Šä¸‹æ–‡ (JSON)
    private String resultMessage;          // ğŸŸ¡ ç»“æœæ¶ˆæ¯
    
    // çŠ¶æ€ä¿¡æ¯
    private JobTaskStatus taskStatus;      // ä»»åŠ¡çŠ¶æ€æšä¸¾ âœ…
    private SystemTaskType taskType;       // ç³»ç»Ÿä»»åŠ¡ç±»å‹æšä¸¾ âœ…
}
```

---

## ğŸ› ï¸ å»ºè®®çš„æ”¹è¿›æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: æ·»åŠ ç±»å‹è½¬æ¢æ³¨è§£ï¼ˆæœ€å°æ”¹åŠ¨ï¼‰

ä¸ºæ‰€æœ‰ JSON å­—æ®µæ·»åŠ  `@TableField` æ³¨è§£ï¼ŒæŒ‡å®š JDBC ç±»å‹ï¼š

```java
// å½“å‰ï¼šä¸æ¸…æ¥šè¿™æ˜¯ JSON
private String argsStr;

// æ”¹è¿›ï¼šæ˜ç¡®å£°æ˜è¿™æ˜¯ JSON å†…å®¹
@TableField(typeHandler = JsonTypeHandler.class)
private String argsStr;
```

### æ–¹æ¡ˆ 2: ä½¿ç”¨å¼ºç±»å‹å¯¹è±¡ï¼ˆæœ€ä½³å®è·µï¼‰

ä¸º JSON å†…å®¹åˆ›å»ºä¸“ç”¨çš„ DTO æˆ– PO ç±»ï¼š

```java
// æ”¹è¿›ï¼šä½¿ç”¨ä¸“ç”¨ç±»ï¼Œè·å¾—ç±»å‹å®‰å…¨
@TableField(typeHandler = JsonTypeHandler.class)
private JobArgsDTO jobArgs;

@TableField(typeHandler = JsonTypeHandler.class)
private Map<String, Object> extAttrs;  // æˆ–å¼ºç±»å‹å¯¹è±¡
```

### æ–¹æ¡ˆ 3: ä½¿ç”¨ JSON æ•°ç»„æ›¿ä»£é€—å·åˆ†éš”

```java
// å½“å‰ï¼ˆé£é™©é«˜ï¼‰ï¼šä¸çŸ¥é“æ˜¯é€—å·åˆ†éš”è¿˜æ˜¯å…¶ä»–
private String notifyIds;  // "1,2,3"

// æ”¹è¿›ï¼šä½¿ç”¨ JSON æ•°ç»„
@TableField(typeHandler = JsonTypeHandler.class)
private List<String> notifyIds;  // ["1", "2", "3"]
```

---

## ğŸ“Š æŒ‰é—®é¢˜åˆ†ç±»ç»Ÿè®¡

| é—®é¢˜ç±»å‹ | å­—æ®µæ•° | é£é™©ç­‰çº§ | ä¼˜å…ˆçº§ |
|---------|--------|---------|--------|
| JSON å­—ç¬¦ä¸²å­—æ®µï¼ˆç¼ºå°‘ç±»å‹æç¤ºï¼‰ | 15 | ğŸ”´ é«˜ | 1ï¸âƒ£ ç«‹å³å¤„ç† |
| ID åˆ—è¡¨å­—æ®µï¼ˆé€—å·åˆ†éš”ï¼‰ | 3 | ğŸŸ¡ ä¸­ | 2ï¸âƒ£ è¿‘æœŸå¤„ç† |
| é—´éš”å­—æ®µï¼ˆCRON/æ•°å­—æ··ç”¨ï¼‰ | 2 | ğŸŸ¡ ä¸­ | 2ï¸âƒ£ è¿‘æœŸå¤„ç† |
| æšä¸¾å­—æ®µ | âœ… æ­£ç¡® | âœ… æ— é—®é¢˜ | - |

**æ€»è®¡éœ€è¦æ”¹è¿›çš„å­—æ®µ**: 20 ä¸ª

---

## âœ… æ— éœ€æ”¹è¿›çš„éƒ¨åˆ†

- âœ… æ‰€æœ‰æšä¸¾å­—æ®µéƒ½å·²æ­£ç¡®å£°æ˜ä¸ºæšä¸¾ç±»å‹
- âœ… åŸºç¡€ä¿¡æ¯å­—æ®µï¼ˆåç§°ã€æè¿°ç­‰ï¼‰å£°æ˜æ­£ç¡®
- âœ… æ•°å€¼å­—æ®µï¼ˆè®¡æ•°ã€è¶…æ—¶ç­‰ï¼‰å£°æ˜æ­£ç¡®
- âœ… æ—¶é—´æˆ³å­—æ®µï¼ˆnextTriggerAt ç­‰ï¼‰å£°æ˜æ­£ç¡®
- âœ… é€»è¾‘åˆ é™¤æ ‡è®°ä½¿ç”¨äº† `@TableLogic` æ³¨è§£

---

## ğŸ¯ ä¿®å¤ä¼˜å…ˆçº§

### ğŸ”´ ç«‹å³å¤„ç†ï¼ˆå½±å“ç¼–ç å®‰å…¨æ€§ï¼‰

è¿™ 15 ä¸ª JSON å­—æ®µåº”è¯¥æ·»åŠ ç±»å‹è½¬æ¢æ³¨è§£ï¼š
- Job: `argsStr`, `extAttrs`, `executorInfo`
- JobTask: `argsStr`, `extAttrs`, `clientInfo`, `wfContext`
- Retry: `argsStr`, `extAttrs`
- RetryTask: `extAttrs`, `clientInfo`
- RetryDeadLetter: `argsStr`, `extAttrs`
- NotifyRecipient: `notifyAttribute`

**å»ºè®®æ–¹æ¡ˆ**:
```java
// åˆ›å»ºé€šç”¨çš„ JSON ç±»å‹å¤„ç†å™¨
@TableField(typeHandler = JsonTypeHandler.class, jdbcType = JdbcType.VARCHAR)
private String argsStr;  // æ˜ç¡®æ³¨è§£ï¼Œä¾¿äºç»´æŠ¤
```

### ğŸŸ¡ è¿‘æœŸå¤„ç†ï¼ˆä¼˜åŒ–æ•°æ®ç»“æ„ï¼‰

è¿™ 3 ä¸ª ID åˆ—è¡¨å­—æ®µåº”è¯¥è½¬æ¢ä¸º JSON æ•°ç»„ï¼š
- Job: `notifyIds`
- RetrySceneConfig: `notifyIds`
- NotifyConfig: `recipientIds`

**å»ºè®®è¿ç§»ç­–ç•¥**:
1. æ·»åŠ æ–°çš„å¼ºç±»å‹å­—æ®µ
2. ç¼–å†™æ•°æ®è¿ç§»è„šæœ¬
3. é€æ­¥åˆ‡æ¢

---

## ğŸ“‹ å­—æ®µä½¿ç”¨æ–‡æ¡£å»ºè®®

ä¸ºäº†é˜²æ­¢åç»­çš„æ··æ·†ï¼Œå»ºè®®ä¸ºæ¯ä¸ª JSON å­—æ®µæ·»åŠ è¯¦ç»†çš„ JavaDocï¼š

```java
/**
 * æ‰§è¡Œæ–¹æ³•å‚æ•°
 * 
 * å­˜å‚¨æ ¼å¼: JSON å­—ç¬¦ä¸²æˆ–çº¯æ–‡æœ¬ï¼ˆç”± argsType å­—æ®µå†³å®šï¼‰
 * ç¤ºä¾‹: {"method": "test", "params": [1, 2, 3]}
 * 
 * @see JobArgsType
 * @see com.old.silence.job.server.dto.JobArgsDTO
 */
@TableField(typeHandler = JsonTypeHandler.class)
private String argsStr;
```

---

## ğŸ” ç›¸å…³ä»£ç ä½ç½®

| æ–‡ä»¶ | è·¯å¾„ |
|------|------|
| æ‰€æœ‰å®ä½“ç±» | `silence-job-server-core/src/main/java/com/old/silence/job/server/domain/model/` |
| åŸºç±» | `silence-data-commons/src/main/java/com/old/silence/data/commons/domain/` |
| æšä¸¾å®šä¹‰ | `silence-job-common/src/main/java/com/old/silence/job/common/enums/` |

---

## ğŸ“ åç»­å»ºè®®

1. **ç¼–å†™å­—æ®µä½¿ç”¨è§„èŒƒæ–‡æ¡£** - æ˜ç¡®å“ªäº›å­—æ®µå­˜å‚¨ JSON
2. **åˆ›å»º JSON ç±»å‹å¤„ç†å™¨** - è‡ªåŠ¨å¤„ç† String â†” Object è½¬æ¢
3. **é€æ­¥é‡æ„ä¸ºå¼ºç±»å‹** - ä½¿ç”¨ DTO è€Œä¸æ˜¯å­—ç¬¦ä¸²
4. **æ·»åŠ æ•°æ®éªŒè¯** - éªŒè¯ JSON æ ¼å¼çš„åˆæ³•æ€§
5. **æ›´æ–° Mapper XML** - æ˜ç¡®æŒ‡å®š JDBC ç±»å‹æ˜ å°„
